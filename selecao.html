<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Diário de Classe</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    body {
      font-family: Arial, Helvetica, sans-serif;
      background-color: #f2f4f7;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
    }

    .container {
      background-color: #ffffff;
      border-radius: 8px;
      padding: 24px;
      width: 100%;
      max-width: 420px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      border-top: 6px solid #003366;
    }

    h2 {
      margin-top: 0;
      margin-bottom: 12px;
      color: #003366;
      text-align: center;
      font-size: 1.3rem;
    }

    .boas-vindas {
      text-align: center;
      font-size: 0.95rem;
      color: #444;
      margin-bottom: 22px;
      line-height: 1.4;
    }

    label {
      display: block;
      margin-bottom: 6px;
      font-weight: bold;
      color: #333;
    }

    select {
      width: 100%;
      padding: 10px;
      margin-bottom: 14px;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 1rem;
      background-color: #fff;
    }

    select:focus {
      outline: none;
      border-color: #00509e;
    }

    button {
      width: 100%;
      padding: 10px;
      background-color: #003366;
      color: #ffffff;
      border: none;
      border-radius: 4px;
      font-size: 1rem;
      font-weight: bold;
      cursor: pointer;
    }

    button:hover {
      background-color: #00509e;
    }

    .footer {
      margin-top: 14px;
      font-size: 0.8rem;
      text-align: center;
      color: #666;
    }
  </style>
</head>

<body>

  <div class="container">
    <h2>Diário de Classe</h2>

    <!-- Mensagem de boas-vindas -->
    <div class="boas-vindas" id="boasVindas"></div>

    <form id="formFiltroTurma">
      <label for="semestre">Semestre</label>
      <select id="semestre" required></select>

      <label for="periodo">Período</label>
      <select id="periodo" required></select>

      <label for="disciplina">Disciplina</label>
      <select id="disciplina" required></select>

      <label for="modulo">Módulo</label>
      <select id="modulo"></select>

      <button type="submit">Gerar relatório</button>
    </form>

    <div class="footer">
      Universidade Federal Fluminense
    </div>
  </div>

  <script>
  const professor = JSON.parse(sessionStorage.getItem("professor"));
  const curriculo = JSON.parse(sessionStorage.getItem("curriculo"));

  if (!professor || !curriculo) {
    alert("Sessão expirada. Faça login novamente.");
    window.location.href = "index.html";
  }

  // Boas-vindas
  document.getElementById("boasVindas").innerHTML = `
    <strong>Professor(a) ${professor.nome}</strong>, seja bem-vindo(a) ao
    <strong>Sistema Eletrônico de Registro de Presença</strong>.<br>
    <span style="font-size:0.85rem; color:#555;">
      Matrícula: ${professor.matricula}
    </span>
  `;

  const selects = {
    semestre: document.getElementById("semestre"),
    periodo: document.getElementById("periodo"),
    disciplina: document.getElementById("disciplina"),
    modulo: document.getElementById("modulo")
  };

  function limparSelect(select, placeholder) {
    select.innerHTML = `<option value="">${placeholder}</option>`;
  }

  function valoresUnicos(campo, filtro = {}) {
    return [...new Set(
      curriculo
        .filter(item =>
          Object.keys(filtro).every(k => item[k] === filtro[k])
        )
        .map(item => item[campo])
    )];
  }

  function popular(select, valores, placeholder) {
    limparSelect(select, placeholder);
    valores.forEach(v => {
      const opt = document.createElement("option");
      opt.value = v;
      opt.textContent = v;
      select.appendChild(opt);
    });
  }

  // Inicial
  popular(selects.semestre, valoresUnicos("semestre"), "Selecione o semestre");

  // Encadeamento
  selects.semestre.addEventListener("change", () => {
    popular(
      selects.periodo,
      valoresUnicos("período", { semestre: selects.semestre.value }),
      "Selecione o período"
    );
    limparSelect(selects.disciplina, "Selecione a disciplina");
    limparSelect(selects.modulo, "Selecione o módulo");
  });

  selects.periodo.addEventListener("change", () => {
    popular(
      selects.disciplina,
      valoresUnicos("disciplina", {
        semestre: selects.semestre.value,
        período: selects.periodo.value
      }),
      "Selecione a disciplina"
    );
    limparSelect(selects.modulo, "Selecione o módulo");
  });

  selects.disciplina.addEventListener("change", () => {
    popular(
      selects.modulo,
      valoresUnicos("módulo", {
        semestre: selects.semestre.value,
        período: selects.periodo.value,
        disciplina: selects.disciplina.value
      }),
      "Selecione o módulo"
    );
  });

  // Botão
  document.getElementById("gerarRelatorio").addEventListener("click", () => {
    if (!selects.modulo.value) {
      alert("Selecione todos os campos.");
      return;
    }

    sessionStorage.setItem("filtro_turma", JSON.stringify({
      semestre: selects.semestre.value,
      periodo: selects.periodo.value,
      disciplina: selects.disciplina.value,
      modulo: selects.modulo.value
    }));

    window.location.href = "relatorio.html";
  });
</script>


</body>
</html>
